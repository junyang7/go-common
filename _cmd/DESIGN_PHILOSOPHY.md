# _cmd åŒ…è®¾è®¡å“²å­¦ï¼šå¿«é€Ÿå¤±è´¥æ¨¡å¼

## ğŸ¯ æ ¸å¿ƒç†å¿µ

**æˆåŠŸå°±ç»§ç»­ï¼Œå¤±è´¥å°±æŠ›å‡º** - ä½¿ç”¨ `_interceptor` æ‹¦æˆªå¼‚å¸¸

---

## âœ… æ”¹è¿›åçš„è®¾è®¡

### è®¾è®¡åŸåˆ™

```go
é»˜è®¤è¡Œä¸ºï¼šå¤±è´¥å°±æŠ›å‡ºï¼ˆpanicï¼‰
ä¾‹å¤–æƒ…å†µï¼šéœ€è¦æ—¶æ‰ç”¨ Safe æ¨¡å¼
```

è¿™ç¬¦åˆä½ çš„ä½¿ç”¨ä¹ æƒ¯ï¼š
1. **æ˜ç¡®æ€§**ï¼šæˆåŠŸå°±æ˜¯ä¸€åˆ‡æˆåŠŸï¼Œå¦åˆ™å°±æ˜¯æŠ¥é”™
2. **ç®€æ´æ€§**ï¼šä¸éœ€è¦åˆ°å¤„å†™ `if err != nil`
3. **ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ–¹æ³•é»˜è®¤è¡Œä¸ºç›¸åŒ

---

## ğŸ“¦ API è®¾è®¡å¯¹æ¯”

### âŒ æ”¹è¿›å‰ï¼ˆä¸ä¸€è‡´ï¼‰

```go
// ç®€å•æ¨¡å¼ï¼šé»˜è®¤ panic âœ…
output := _cmd.Execute("ls", "-l")

// æ„å»ºå™¨æ¨¡å¼ï¼šé»˜è®¤ä¸ panic âŒ ä¸ä¸€è‡´ï¼
result := _cmd.New("ls").Output()  // è¿”å› Result
if !result.Success() {
    // è¿˜è¦æ‰‹åŠ¨æ£€æŸ¥...
}

// å¿…é¡»ç”¨ Must æ‰ panic âŒ éº»çƒ¦
output := _cmd.New("ls").MustOutput()
```

**é—®é¢˜ï¼š** ç®€å•æ¨¡å¼å’Œæ„å»ºå™¨æ¨¡å¼è¡Œä¸ºä¸ä¸€è‡´ï¼Œè¿èƒŒé¢„æœŸï¼

### âœ… æ”¹è¿›åï¼ˆä¸€è‡´ï¼‰

```go
// ç®€å•æ¨¡å¼ï¼šé»˜è®¤ panic âœ…
output := _cmd.Execute("ls", "-l")

// æ„å»ºå™¨æ¨¡å¼ï¼šé»˜è®¤ä¹Ÿ panic âœ… ä¸€è‡´ï¼
output := _cmd.New("ls").Output()  // å¤±è´¥å°±æŠ›å‡º

// éœ€è¦æ—¶æ‰ Safe
result := _cmd.New("ls").OutputSafe()  // è¿”å› Result
if !result.Success() {
    // æ‰‹åŠ¨å¤„ç†...
}
```

**ä¼˜åŠ¿ï¼š** æ‰€æœ‰æ–¹æ³•é»˜è®¤è¡Œä¸ºä¸€è‡´ï¼Œç¬¦åˆ"å¿«é€Ÿå¤±è´¥"ç†å¿µï¼

---

## ğŸ”„ API å˜æ›´æ¸…å•

### ç®€å•æ¨¡å¼ï¼ˆæ— å˜åŒ–ï¼‰

| æ–¹æ³• | è¡Œä¸º | è¯´æ˜ |
|------|------|------|
| `Execute()` | panic | âœ… ä¿æŒä¸å˜ |
| `ExecuteAsInt64()` | panic | âœ… ä¿æŒä¸å˜ |
| `ExecuteAsString()` | panic | âœ… ä¿æŒä¸å˜ |
| `ExecuteSafe()` | ä¸ panic | âœ… ä¿æŒä¸å˜ |
| `ExecuteInteractive()` | panic | âœ… ä¿æŒä¸å˜ |

### æ„å»ºå™¨æ¨¡å¼ï¼ˆé‡å¤§å˜æ›´ï¼‰â­

#### å˜æ›´å¯¹æ¯”

| æ—§ API | æ–° API | è¡Œä¸ºå˜åŒ– |
|--------|--------|---------|
| `.Output()` | `.Output()` | âŒâ†’âœ… ç°åœ¨ä¼š panic |
| `.Run()` | `.Run()` | âŒâ†’âœ… ç°åœ¨ä¼š panic |
| `.MustOutput()` | **å·²ç§»é™¤** | ç”¨ `.Output()` ä»£æ›¿ |
| `.MustRun()` | **å·²ç§»é™¤** | ç”¨ `.Run()` ä»£æ›¿ |
| - | `.OutputSafe()` â­ | **æ–°å¢**ï¼šä¸ panic |
| - | `.RunSafe()` â­ | **æ–°å¢**ï¼šä¸ panic |

#### æ–°å¢æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `.OutputAsString()` | æ‰§è¡Œå¹¶è¿”å›å­—ç¬¦ä¸²ï¼ˆpanicï¼‰ |
| `.OutputAsInt64()` | æ‰§è¡Œå¹¶è¿”å› int64ï¼ˆpanicï¼‰ |
| `.OutputSafe()` | å®‰å…¨æ‰§è¡Œï¼Œè¿”å› Result |
| `.RunSafe()` | å®‰å…¨æ‰§è¡Œï¼Œä¸æ•è·è¾“å‡º |

### ç®¡é“ï¼ˆå˜æ›´ï¼‰

| æ—§ API | æ–° API | è¡Œä¸ºå˜åŒ– |
|--------|--------|---------|
| `Pipe()` | `Pipe()` | âœ… ä¿æŒ panic |
| - | `PipeSafe()` â­ | **æ–°å¢**ï¼šä¸ panic |

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹å¯¹æ¯”

### ç¤ºä¾‹ 1ï¼šç®€å•æ‰§è¡Œ

```go
// âœ… æ”¹è¿›å‰
output := _cmd.Execute("ls", "-l")

// âœ… æ”¹è¿›åï¼ˆæ— å˜åŒ–ï¼‰
output := _cmd.Execute("ls", "-l")
```

### ç¤ºä¾‹ 2ï¼šæ„å»ºå™¨åŸºç¡€ä½¿ç”¨

```go
// âŒ æ”¹è¿›å‰ï¼šéœ€è¦æ£€æŸ¥é”™è¯¯
result := _cmd.New("ls", "-l").Output()
if !result.Success() {
    // æ‰‹åŠ¨å¤„ç†é”™è¯¯...
}
output := result.Stdout

// âœ… æ”¹è¿›åï¼šé»˜è®¤ panicï¼Œæ›´ç®€æ´
output := _cmd.New("ls", "-l").Output()
// æˆåŠŸå°±ç»§ç»­ï¼Œå¤±è´¥å°±æŠ›å‡º
```

### ç¤ºä¾‹ 3ï¼šæ„å»ºå™¨å¤æ‚é…ç½®

```go
// âŒ æ”¹è¿›å‰ï¼šéº»çƒ¦
output := _cmd.New("script.sh").
    Dir("/app").
    AddEnv("DEBUG", "true").
    MustOutput()  // éœ€è¦è®°å¾—ç”¨ Must

// âœ… æ”¹è¿›åï¼šè‡ªç„¶
output := _cmd.New("script.sh").
    Dir("/app").
    AddEnv("DEBUG", "true").
    Output()  // é»˜è®¤å°±æ˜¯ panic
```

### ç¤ºä¾‹ 4ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†é”™è¯¯

```go
// âŒ æ”¹è¿›å‰ï¼šä¸æ¸…æ™°
result := _cmd.New("risky-command").Output()
if !result.Success() {
    // å¤„ç†...
}

// âœ… æ”¹è¿›åï¼šSafe æ˜ç¡®è¡¨è¾¾æ„å›¾
result := _cmd.New("risky-command").OutputSafe()
if !result.Success() {
    // æ˜ç¡®çŸ¥é“è¿™æ˜¯ Safe æ¨¡å¼
}
```

---

## ğŸ“ ä½¿ç”¨å†³ç­–æ ‘

```
ä½ çš„å‘½ä»¤ä¼šå¤±è´¥å—ï¼Ÿ

â”œâ”€ 99% åœºæ™¯ï¼šä¸ç¡®å®šæˆ–å¸Œæœ›å¤±è´¥å°±åœæ­¢
â”‚  â””â”€ ç”¨é»˜è®¤æ–¹æ³•ï¼ˆè‡ªåŠ¨ panicï¼‰
â”‚     â”œâ”€ Execute() / ExecuteAsString()
â”‚     â”œâ”€ New().Output() / New().Run()
â”‚     â””â”€ ExecuteWithTimeout() / Pipe()
â”‚
â””â”€ 1% åœºæ™¯ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†é”™è¯¯
   â””â”€ ç”¨ Safe æ–¹æ³•ï¼ˆè¿”å› Resultï¼‰
      â”œâ”€ ExecuteSafe()
      â”œâ”€ New().OutputSafe() / New().RunSafe()
      â””â”€ PipeSafe()
```

---

## ğŸ” å®é™…åœºæ™¯

### åœºæ™¯ 1ï¼šGit æ“ä½œï¼ˆ99% åœºæ™¯ï¼‰

```go
// âœ… æ¨èï¼šé»˜è®¤ panic
branch := _cmd.ExecuteAsString("git", "branch", "--show-current")
// æˆåŠŸå°±ç»§ç»­ï¼Œå¤±è´¥å°±æŠ›å‡ºï¼ˆç¬¦åˆé¢„æœŸï¼‰

hash := _cmd.New("git", "rev-parse", "HEAD").
    Dir("/app/repo").
    OutputAsString()
// å¤±è´¥è¯´æ˜ repo æœ‰é—®é¢˜ï¼Œåº”è¯¥åœæ­¢
```

### åœºæ™¯ 2ï¼šDocker æ“ä½œï¼ˆ99% åœºæ™¯ï¼‰

```go
// âœ… æ¨èï¼šé»˜è®¤ panic
containerID := _cmd.New("docker", "run", "-d", "nginx").
    OutputAsString()
// å¯åŠ¨å¤±è´¥å°±åº”è¯¥åœæ­¢ï¼Œä¸åº”è¯¥ç»§ç»­

logs := _cmd.New("docker", "logs", containerID).
    Timeout(time.Second * 5).
    OutputAsString()
// è·å–æ—¥å¿—å¤±è´¥è¯´æ˜å®¹å™¨æœ‰é—®é¢˜ï¼Œåº”è¯¥åœæ­¢
```

### åœºæ™¯ 3ï¼šå¥åº·æ£€æŸ¥ï¼ˆ1% åœºæ™¯ï¼‰

```go
// âœ… ç”¨ Safeï¼šéœ€è¦åˆ¤æ–­æœåŠ¡æ˜¯å¦å¥åº·
result := _cmd.New("curl", "-f", "http://localhost:8080/health").
    Timeout(time.Second * 2).
    OutputSafe()

if result.Success() {
    fmt.Println("âœ… Service healthy")
} else {
    fmt.Println("âŒ Service unhealthy")
    // ä¸å¸Œæœ›è¿™é‡Œ panicï¼Œè€Œæ˜¯è¿”å›å¥åº·çŠ¶æ€
}
```

### åœºæ™¯ 4ï¼šå¯é€‰å‘½ä»¤ï¼ˆ1% åœºæ™¯ï¼‰

```go
// âœ… ç”¨ Safeï¼šå‘½ä»¤å¯èƒ½ä¸å­˜åœ¨
result := _cmd.ExecuteSafe("git", "status")
if result.Success() {
    fmt.Println("Git repository detected")
    // ç»§ç»­ git ç›¸å…³æ“ä½œ
} else {
    fmt.Println("Not a git repository, skipping git operations")
    // ä¸æ˜¯ git ä»“åº“ä¹Ÿæ²¡å…³ç³»ï¼Œç»§ç»­å…¶ä»–é€»è¾‘
}
```

---

## ğŸ“Š ä½¿ç”¨æ¯”ä¾‹

### æ¨èçš„ä½¿ç”¨æ¯”ä¾‹

```
é»˜è®¤æ–¹æ³•ï¼ˆpanicï¼‰: 95-99%
â”œâ”€ Execute()
â”œâ”€ ExecuteAsString()
â”œâ”€ New().Output()
â”œâ”€ New().Run()
â””â”€ Pipe()

Safe æ–¹æ³•ï¼ˆä¸ panicï¼‰: 1-5%
â”œâ”€ ExecuteSafe()
â”œâ”€ New().OutputSafe()
â”œâ”€ New().RunSafe()
â””â”€ PipeSafe()
```

---

## âœ¨ è®¾è®¡ä¼˜åŠ¿

### 1. æ˜ç¡®æ€§

```go
âœ… é»˜è®¤è¡Œä¸ºæ˜ç¡®ï¼šå¤±è´¥å°±æŠ›å‡º
âœ… Safe æ–¹æ³•æ˜ç¡®ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†

// çœ‹ä»£ç å°±çŸ¥é“è¡Œä¸º
output := cmd.Output()      // å¤±è´¥ä¼šæŠ›å‡º
result := cmd.OutputSafe()  // ä¸ä¼šæŠ›å‡ºï¼Œéœ€è¦æ£€æŸ¥
```

### 2. ä¸€è‡´æ€§

```go
âœ… ç®€å•æ¨¡å¼å’Œæ„å»ºå™¨æ¨¡å¼è¡Œä¸ºä¸€è‡´
âœ… æ‰€æœ‰ Execute* ç³»åˆ—è¡Œä¸ºä¸€è‡´
âœ… æ‰€æœ‰ New().* é»˜è®¤è¡Œä¸ºä¸€è‡´

// æ— éœ€è®°å¿†ç‰¹æ®Šè§„åˆ™
_cmd.Execute("ls")          // panic
_cmd.New("ls").Output()     // panicï¼ˆä¸€è‡´ï¼ï¼‰
```

### 3. ç®€æ´æ€§

```go
âœ… ä¸éœ€è¦åˆ°å¤„å†™é”™è¯¯æ£€æŸ¥
âœ… ä»£ç æ›´çŸ­ï¼Œå¯è¯»æ€§æ›´å¥½

// æ”¹è¿›å‰ï¼ˆå†—é•¿ï¼‰
result := cmd.Output()
if !result.Success() {
    return nil, result.Error
}
output := result.Stdout

// æ”¹è¿›åï¼ˆç®€æ´ï¼‰
output := cmd.Output()
```

### 4. ç¬¦åˆç›´è§‰

```go
âœ… é»˜è®¤è¡Œä¸ºç¬¦åˆé¢„æœŸ
âœ… éœ€è¦ç‰¹æ®Šå¤„ç†æ—¶æ‰ç”¨ Safe

// 99% åœºæ™¯
output := cmd.Output()  // å°±åº”è¯¥å¤±è´¥å°±åœæ­¢

// 1% ç‰¹æ®Šåœºæ™¯
result := cmd.OutputSafe()  // æ˜ç¡®éœ€è¦ç‰¹æ®Šå¤„ç†
if !result.Success() {
    // è‡ªå®šä¹‰å¤„ç†...
}
```

---

## ğŸ”’ é”™è¯¯å¤„ç†ç†å¿µ

### å¿«é€Ÿå¤±è´¥ vs ä¼˜é›…å¤„ç†

```go
// âœ… å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤ï¼‰ï¼š99% åœºæ™¯
output := _cmd.Execute("important-command")
// å¤±è´¥è¯´æ˜ç¯å¢ƒæœ‰é—®é¢˜ï¼Œåº”è¯¥ç«‹å³åœæ­¢

// âœ… ä¼˜é›…å¤„ç†ï¼ˆSafeï¼‰ï¼š1% åœºæ™¯
result := _cmd.ExecuteSafe("optional-command")
if result.Success() {
    // å‘½ä»¤å­˜åœ¨ï¼Œç»§ç»­...
} else {
    // å‘½ä»¤ä¸å­˜åœ¨ä¹Ÿæ²¡å…³ç³»ï¼Œè·³è¿‡...
}
```

### ä»€ä¹ˆæ—¶å€™ç”¨ Safeï¼Ÿ

#### âœ… åº”è¯¥ç”¨ Safe çš„åœºæ™¯

```go
// 1. å¥åº·æ£€æŸ¥
result := _cmd.New("curl", healthURL).OutputSafe()

// 2. å¯é€‰åŠŸèƒ½
result := _cmd.ExecuteSafe("git", "status")

// 3. æ¢æµ‹å‘½ä»¤æ˜¯å¦å­˜åœ¨
result := _cmd.ExecuteSafe("which", "docker")

// 4. ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼ˆå¯èƒ½å¤±è´¥ï¼‰
result := _cmd.New(userCommand).OutputSafe()
```

#### âŒ ä¸åº”è¯¥ç”¨ Safe çš„åœºæ™¯

```go
// 1. å…³é”®æ“ä½œï¼ˆå¤±è´¥å°±åº”è¯¥åœæ­¢ï¼‰
output := _cmd.Execute("deploy.sh")

// 2. ç¯å¢ƒæ£€æŸ¥ï¼ˆå¤±è´¥è¯´æ˜ç¯å¢ƒæœ‰é—®é¢˜ï¼‰
nodeVersion := _cmd.ExecuteAsString("node", "--version")

// 3. ä¾èµ–å‘½ä»¤ï¼ˆåç»­ä¾èµ–è¿™ä¸ªç»“æœï¼‰
gitHash := _cmd.New("git", "rev-parse", "HEAD").OutputAsString()

// 4. æ„å»ºæµç¨‹ï¼ˆä»»ä½•æ­¥éª¤å¤±è´¥éƒ½åº”è¯¥åœæ­¢ï¼‰
_cmd.New("npm", "install").Run()
_cmd.New("npm", "run", "build").Run()
```

---

## ğŸ“ˆ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»

å¦‚æœä½ ä¹‹å‰çš„ä»£ç ä½¿ç”¨äº†æ„å»ºå™¨ï¼Œéœ€è¦åšä»¥ä¸‹è°ƒæ•´ï¼š

#### åœºæ™¯ 1ï¼šä¹‹å‰ç”¨ `.Output()` å¹¶æ£€æŸ¥é”™è¯¯

```go
// æ—§ä»£ç 
result := _cmd.New("ls").Output()
if !result.Success() {
    // å¤„ç†é”™è¯¯...
}

// æ–°ä»£ç é€‰é¡¹ Aï¼šå¦‚æœå¤±è´¥åº”è¯¥åœæ­¢ï¼ˆ99% åœºæ™¯ï¼‰
output := _cmd.New("ls").Output()
// ä¸éœ€è¦æ£€æŸ¥ï¼Œå¤±è´¥ä¼šè‡ªåŠ¨æŠ›å‡º

// æ–°ä»£ç é€‰é¡¹ Bï¼šå¦‚æœéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼ˆ1% åœºæ™¯ï¼‰
result := _cmd.New("ls").OutputSafe()
if !result.Success() {
    // å¤„ç†é”™è¯¯...
}
```

#### åœºæ™¯ 2ï¼šä¹‹å‰ç”¨ `.MustOutput()`

```go
// æ—§ä»£ç 
output := _cmd.New("ls").MustOutput()

// æ–°ä»£ç ï¼ˆæ›´ç®€æ´ï¼‰
output := _cmd.New("ls").Output()
// MustOutput å·²ç§»é™¤ï¼ŒOutput å°±æ˜¯é»˜è®¤ panic
```

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

1. **âœ… ç»Ÿä¸€è¡Œä¸º**ï¼šæ‰€æœ‰æ–¹æ³•é»˜è®¤éƒ½æ˜¯ panic æ¨¡å¼
2. **âœ… æ˜ç¡®æ„å›¾**ï¼šSafe æ–¹æ³•æ˜ç¡®è¡¨è¾¾"éœ€è¦æ‰‹åŠ¨å¤„ç†"
3. **âœ… ç®€åŒ–ä»£ç **ï¼š99% åœºæ™¯ä¸éœ€è¦é”™è¯¯æ£€æŸ¥
4. **âœ… ç¬¦åˆç›´è§‰**ï¼šå¤±è´¥å°±åº”è¯¥åœæ­¢ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰

### API è®¾è®¡æ€»ç»“

| æ–¹æ³•ç±»å‹ | é»˜è®¤è¡Œä¸º | ä½¿ç”¨é¢‘ç‡ |
|---------|---------|---------|
| `Execute*` | panic | 90% |
| `New().Output*()` | panic | 9% |
| `*Safe()` | ä¸ panic | 1% |

### è®¾è®¡å“²å­¦

```
æˆåŠŸ â†’ ç»§ç»­æ‰§è¡Œ
å¤±è´¥ â†’ æŠ›å‡ºå¼‚å¸¸ï¼ˆä½¿ç”¨ _interceptorï¼‰

ä¾‹å¤–æƒ…å†µæ‰ç”¨ Safe æ¨¡å¼
```

---

**è¿™å°±æ˜¯ç¬¦åˆä½ ä½¿ç”¨ä¹ æƒ¯çš„è®¾è®¡ï¼** âœ…

ç®€æ´ã€æ˜ç¡®ã€ä¸€è‡´ - è®©å‘½ä»¤æ‰§è¡Œå˜å¾—ç®€å•ï¼

